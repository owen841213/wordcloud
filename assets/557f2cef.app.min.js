/*! wordcloud-app  2017-12-05 */

var FACEBOOK_APP_ID="",GOOGLE_CLIENT_ID="",IMGUR_CLIENT_ID="",DONATE_HTML="",WordCloudApp=function(){if(!((window.WordFreq&&window.WordFreq.isSupported||window.WordFreqSync&&window.WordFreqSync.isSupported)&&WordCloud.isSupported&&Object.keys&&Array.prototype.map&&Array.prototype.forEach&&Array.prototype.indexOf&&Function.prototype.bind&&"onhashchange"in window))return window.onload=function(){var a=document.getElementById("wc-browser-support");try{delete a.hidden}catch(a){}a.removeAttribute&&a.removeAttribute("hidden")},this.isSupported=!1,void this.logAction("WordCloudApp::isSupported::false");this.isSupported=!0,this.logAction("WordCloudApp::isSupported::true"),this.isFullySupported=function(){if(!FilePanelView.prototype.isSupported)return!1;if(window.HTMLCanvasElement.prototype.toBlob)return!0;var a=window.Blob&&function(){try{return Boolean(new Blob)}catch(a){return!1}}(),b=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;return!!((a||b)&&window.atob&&window.ArrayBuffer&&window.Uint8Array)}(),this.logAction("WordCloudApp::isFullySupported::"+this.isFullySupported),window.addEventListener("load",this),this.fetchers={},this.views={},this.currentUIState=this.UI_STATE_LOADING,this.UIStateViewMap=[["loading"],["canvas","source-dialog"],["loading","dashboard"],["canvas","dashboard"],["canvas","dashboard","list-dialog"],["loading","dashboard"],["canvas","dashboard","sharer-dialog"],["canvas","about-dialog"]],this.wordfreqOption={workerUrl:"./assets/wordfreq/src/wordfreq.worker.js?_=jatqawb2"},this.shapes=[{shape:"circle"},{shape:function(a){var b=(a+Math.PI/4)%(2*Math.PI/4);return 1/(Math.cos(b)+Math.sin(b))}},{shape:"triangle-forward",ellipticity:1},{shape:"star",ellipticity:1}];var a='"Trebuchet MS", "Heiti TC", "微軟正黑體", "Arial Unicode MS", "Droid Fallback Sans", sans-serif',b='Baskerville, "Times New Roman", "華康儷金黑 Std", "華康儷宋 Std",  DFLiKingHeiStd-W8, DFLiSongStd-W5, "Hiragino Mincho Pro", "LiSong Pro Light", "新細明體", serif',c=function(a){return function(){return a[Math.floor(Math.random()*a.length)]}};this.themes=[{fontFamily:b,color:c(["#66d9ef","#a6e22d","#fd9720","#a6e22a","#a581ff","#f92772"]),backgroundColor:"#272822"},{fontFamily:a,color:c(["#07ABDA","#63D6F6","#0F7BDC","#69B4F7","#00DBB6","#376F65","#004438","#5FF7DD"]),backgroundColor:"#AAF7EA"},{fontFamily:b,color:c(["#2F55D1","#4058A5","#133193","#98AFFD"]),backgroundColor:"#e3e9fd"},{fontFamily:a,color:c(["#c30000","#c37a00","#650281","#de3333","#de5c5c","#7e602c","#633e00","#481e53"]),backgroundColor:"#edd1a4"},{fontFamily:a,color:function(){return"rgb("+Math.floor(128*Math.random()+48).toString(10)+","+Math.floor(128*Math.random()+48).toString(10)+","+Math.floor(128*Math.random()+48).toString(10)+")"},backgroundColor:"#eee"},{fontFamily:b,color:"random-light",backgroundColor:"#000"},{fontFamily:b,color:c(["#3a3f42","#575d51","#42361d"]),backgroundColor:"#8d8380"},{fontFamily:b,color:c(["#f7e4be","#f0f4bc","#9a80a4","#848da6"]),backgroundColor:"#223564"},{fontFamily:b,color:"#d0d0d0",backgroundColor:"#999"},{fontFamily:a,color:"rgba(255,255,255,0.8)",backgroundColor:"#353130"},{fontFamily:a,color:"rgba(0,0,0,0.7)",backgroundColor:"rgba(255, 255, 255, 1)"}],this.data={theme:0,shape:0,gridSize:void 0,weightFactor:void 0,drawOutOfBound:!0}};WordCloudApp.prototype.addView=function(a){this.views[a.name]=a,a.app=this},WordCloudApp.prototype.addFetcher=function(a){a.types.forEach(function(b){this.fetchers[b]=a}.bind(this)),a.app=this},WordCloudApp.prototype.pushUrlHash=function(a){if(a===window.location.hash)return this.route(),!0;this.backToReset=!window.location.hash.substr(1),this.lastUrlHashChangePushedByScript=!0;try{window.location.hash=a}catch(a){return!1}return!0},WordCloudApp.prototype.reset=function(){window.location.hash.substr(1)&&(this.backToReset?window.history.back():this.pushUrlHash(""))},WordCloudApp.prototype.UI_STATE_LOADING=0,WordCloudApp.prototype.UI_STATE_SOURCE_DIALOG=1,WordCloudApp.prototype.UI_STATE_WORKING=2,WordCloudApp.prototype.UI_STATE_DASHBOARD=3,WordCloudApp.prototype.UI_STATE_LIST_DIALOG=4,WordCloudApp.prototype.UI_STATE_ERROR_WITH_DASHBOARD=5,WordCloudApp.prototype.UI_STATE_SHARER_DIALOG=6,WordCloudApp.prototype.UI_STATE_ABOUT_DIALOG=7,WordCloudApp.prototype.switchUIState=function(a){if(!this.UIStateViewMap[a])throw"Undefined state "+a;document.activeElement&&document.activeElement!==document.body&&document.activeElement.blur();var b=Object.keys(this.views),c=this.currentUIState;b.forEach(function(b){this.views[b][-1!==this.UIStateViewMap[a].indexOf(b)?"show":"hide"](c,a)}.bind(this)),this.currentUIState=a},WordCloudApp.prototype.handleData=function(a,b){if(this.logAction("WordCloudApp::handleData",b+" ("+a.length+")"),!a.length)return this.switchUIState(this.UI_STATE_ERROR_WITH_DASHBOARD),void this.views.loading.updateLabel(this.views.loading.LABEL_ERROR_DATA);this.currentFetcher=void 0,this.views.loading.updateLabel(this.views.loading.LABEL_ANALYZING),this.data.title=b;var c;WordFreq?this.wordfreq=WordFreq(this.wordfreqOption).process(a).getVolume(function(a){c=a}).getList(function(a){this.wordfreq=void 0,this.handleList(a,c)}.bind(this)):this.wordfreq=setTimeout(function(){var b=WordFreqSync(this.wordfreqOption),c=b.process(a),d=b.getVolume();this.wordfreq=void 0,this.handleList(c,d)}.bind(this))},WordCloudApp.prototype.stopHandleData=function(){this.wordfreq&&("object"==typeof this.wordfreq?this.wordfreq.stop(!1):clearTimeout(this.wordfreq),this.wordfreq=void 0)},WordCloudApp.prototype.handleList=function(a,b){if(this.logAction("WordCloudApp::handleList",a.length),!a.length)return this.switchUIState(this.UI_STATE_ERROR_WITH_DASHBOARD),void this.views.loading.updateLabel(this.views.loading.LABEL_ERROR_LIST);this.switchUIState(this.UI_STATE_DASHBOARD),this.data.list=a,this.data.gridSize=4,this.data.theme=Math.floor(Math.random()*this.themes.length),this.calculateWeightFactor(b),this.draw()},WordCloudApp.prototype.draw=function(){var a=this.views.canvas;a.setDimension(),a.draw(this.getWordCloudOption());var b=this.parseHash();this.logAction("WordCloudApp::draw::"+b[0],b[1].substr(0,128))},WordCloudApp.prototype.getCanvasElement=function(){return this.views.canvas.canvasElement},WordCloudApp.prototype.calculateWeightFactor=function(a){var b=this.views.canvas.documentWidth,c=this.views.canvas.documentHeight;this.data.weightFactor=Math.sqrt(b*c/a)},WordCloudApp.prototype.getWordCloudOption=function(){var a={};return Object.keys(this.data).forEach(function(b){a[b]=this.data[b]}.bind(this)),Object.keys(this.themes[this.data.theme]).forEach(function(b){a[b]=this.themes[this.data.theme][b]}.bind(this)),Object.keys(this.shapes[this.data.shape]).forEach(function(b){a[b]=this.shapes[this.data.shape][b]}.bind(this)),a},WordCloudApp.prototype.showSharer=function(){this.switchUIState(this.UI_STATE_SHARER_DIALOG)},WordCloudApp.prototype.route=function(){var a=window.location.hash.substr(1);if(this.backToReset&&!this.lastUrlHashChangePushedByScript&&(this.backToReset=!1),this.lastUrlHashChangePushedByScript=!1,this.currentFetcher&&(this.currentFetcher.stop(),this.currentFetcher=void 0),this.stopHandleData(),!a)return this.switchUIState(this.UI_STATE_SOURCE_DIALOG),void this.logAction("WordCloudApp::route::source-dialog");var b=this.parseHash(),c=b[0],d=b[1];b=void 0,this.logAction("WordCloudApp::route::"+c,d.substr(0,128));var e=-1===c.indexOf(".")?c:c.split(".")[0];if(e in this.fetchers){this.switchUIState(this.UI_STATE_WORKING);var f=this.currentFetcher=this.fetchers[e];this.views.loading.updateLabel(f.LABEL_VERB),f.getData(c,d)}else this.reset()},WordCloudApp.prototype.logAction=function(a,b,c){if(window._gaq){var d=["_trackEvent","Word Cloud"];void 0!==a&&(d.push(a.toString()),void 0!==b&&(d.push(b.toString()),void 0!==c&&d.push(parseFloat(c,10)))),window._gaq.push(d)}},WordCloudApp.prototype.parseHash=function(){var a,b,c=window.location.hash.substr(1);return c.match(/^([^:]+):?(.*)$/).forEach(function(c,d){switch(d){case 1:a=c;break;case 2:b=c}}),[a,b]},WordCloudApp.prototype.handleEvent=function(a){switch(a.type){case"load":window.removeEventListener("load",this),window.addEventListener("hashchange",this),this.route();break;case"hashchange":this.route()}},WordCloudApp.prototype.uninit=function(){window.removeEventListener("load",this),window.removeEventListener("hashchange",this)};var FacebookSDKLoader=function(){if(!FACEBOOK_APP_ID)throw"No FACEBOOK_APP_ID defined.";this.loaded=!1};FacebookSDKLoader.prototype.load=function(a){if(this.loaded)throw"FacebookSDKLoader shouldn't be reused.";if(this.loaded=!0,window.FB)return void a();if(window.fbAsyncInit){var b=window.fbAsyncInit;return void(window.fbAsyncInit=function(){window.fbAsyncInit=null,b(),a()}.bind(this))}var c=document.createElement("div");c.id="fb-root",document.body.insertBefore(c,document.body.firstChild),function(a,b,c){var d,e=a.getElementsByTagName(b)[0];a.getElementById(c)||(d=a.createElement(b),d.id=c,d.src="//connect.facebook.net/en_US/all.js",e.parentNode.insertBefore(d,e))}(document,"script","facebook-jssdk");var d=window.FACEBOOK_CHANNEL_URL||document.location.href.replace(/\/(index.html)?(#.*)?$/i,"/facebook-channel.html");window.fbAsyncInit=function(){window.fbAsyncInit=null,FB.init({appId:FACEBOOK_APP_ID,channelUrl:d}),a()}};var View=function(){};View.prototype.load=function(a,b){a=a||{};for(var c in b){if(c in this)break;this[c]=c in a?a[c]:b[c],("element"===c||/Element$/.test(c))&&(this[c]="string"==typeof this[c]?document.getElementById(this[c]):this[c])}},View.prototype.show=function(a,b){return!("beforeShow"in this&&!1===this.beforeShow.apply(this,arguments))&&(this.element.removeAttribute("hidden"),"afterShow"in this&&this.afterShow.apply(this,arguments),!0)},View.prototype.hide=function(a,b){return!("beforeHide"in this&&!1===this.beforeHide.apply(this,arguments))&&(this.element.setAttribute("hidden",!0),"afterHide"in this&&this.afterHide.apply(this,arguments),!0)};var LanguageSwitcherView=function(a){this.load(a,{element:"wc-language"});var b=navigator.language||navigator.userLanguage;b=b.replace(/-[a-z]{2}$/i,function(a){return a.toUpperCase()});var c=this.langs=[];Array.prototype.forEach.call(this.element.children,function(a){c.push(a.value),a.value===b&&(a.selected=!0)}),-1===c.indexOf(b)&&(this.element.selectedIndex=0),document.addEventListener("localized",this),this.element.addEventListener("change",this)};LanguageSwitcherView.prototype=new View,LanguageSwitcherView.prototype.handleEvent=function(a){switch(a.type){case"change":document.webL10n.setLanguage(this.element.value),this.app.logAction("LanguageSwitcherView::change",this.element.value);break;case"localized":this.app.logAction("LanguageSwitcherView::localized",document.documentElement.lang)}};var LoadingView=function(a){this.load(a,{name:"loading",element:"wc-loading",labelElement:"wc-loading-label"}),this.stringIds=["downloading","loading","analyzing","no_data","no_list_output"]};LoadingView.prototype=new View,LoadingView.prototype.LABEL_DOWNLOADING=0,LoadingView.prototype.LABEL_LOADING=1,LoadingView.prototype.LABEL_ANALYZING=2,LoadingView.prototype.LABEL_ERROR_DATA=3,LoadingView.prototype.LABEL_ERROR_LIST=4,LoadingView.prototype.beforeShow=function(a,b){b===this.app.UI_STATE_ERROR_WITH_DASHBOARD?this.element.className="error":this.element.className=""},LoadingView.prototype.updateLabel=function(a){if(!this.stringIds[a])throw"Undefined stringId "+a;this.labelElement.setAttribute("data-l10n-id",this.stringIds[a]),__(this.labelElement)};var ListDialogView=function(a){this.load(a,{name:"list-dialog",element:"wc-list-dialog",textElement:"wc-list-edit",cancelBtnElement:"wc-list-cancel-btn",confirmBtnElement:"wc-list-confirm-btn"}),this.cancelBtnElement.addEventListener("click",this),this.confirmBtnElement.addEventListener("click",this)};ListDialogView.prototype=new View,ListDialogView.prototype.beforeShow=function(){this.textElement.value=this.app.data.list.map(function(a){return a[1]+"\t"+a[0]}).join("\n")},ListDialogView.prototype.afterShow=function(){this.textElement.focus()},ListDialogView.prototype.handleEvent=function(a){switch(a.target){case this.confirmBtnElement:this.submit();break;case this.cancelBtnElement:this.close()}},ListDialogView.prototype.submit=function(){var a,b=this.textElement;a=window.btoa?"#base64-list:"+window.btoa(unescape(encodeURIComponent(b.value))):"#list:"+encodeURIComponent(b.value),this.app.pushUrlHash(a)||this.app.pushUrlHash("#list")},ListDialogView.prototype.close=function(){this.app.switchUIState(this.app.UI_STATE_DASHBOARD)};var AboutDialogView=function(a){this.load(a,{name:"about-dialog",element:"wc-about-dialog",donateElement:"wc-about-donate",donateContentElement:"wc-about-donate-content",contentElement:"wc-about-content",closeBtnElement:"wc-about-close-btn"}),this.loaded=!1,this.closeBtnElement.addEventListener("click",this),this.contentElement.addEventListener("click",this),this.donateContentElement.addEventListener("submit",this),document.addEventListener("localized",this)};AboutDialogView.prototype=new View,AboutDialogView.prototype.beforeShow=function(){this.app.logAction("AboutDialogView::view"),this.loaded=!0;var a=document.documentElement.lang;this.loadContent(a,!0)},AboutDialogView.prototype.loadContent=function(a,b){var c=document.createElement("iframe");c.src="about."+a+".html",this.contentElement.appendChild(c),c.onload=function(){for(var a=document.importNode(c.contentWindow.document.body,!0),b=document.createDocumentFragment();a.firstElementChild;)b.appendChild(a.firstElementChild);for(var d=this.contentElement;d.firstChild;)d.removeChild(d.firstChild);d.appendChild(b)}.bind(this),b&&(c.onerror=function(){this.loaded=!1,this.element.hasAttribute("hidden")||this.app.switchUIState(this.app.UI_STATE_SOURCE_DIALOG)}.bind(this)),window.DONATE_HTML&&(this.donateElement.removeAttribute("hidden"),this.donateContentElement.innerHTML=window.DONATE_HTML.replace(/%lang/,a.replace(/-/,"_")))},AboutDialogView.prototype.handleEvent=function(a){if("localized"===a.type)return void(this.loaded=!1);switch(a.currentTarget){case this.contentElement:if("A"!==a.target.tagName)break;a.preventDefault(),window.open(a.target.href),this.app.logAction("AboutDialogView::externalLink",a.target.href);break;case this.donateContentElement:this.app.logAction("AboutDialogView::donateLink");break;case this.closeBtnElement:this.close()}},AboutDialogView.prototype.close=function(){this.app.switchUIState(this.app.UI_STATE_SOURCE_DIALOG)};var SNSPushView=function(a){this.load(a,{name:"sns-push",element:"wc-sns-push",facebookElement:"wc-sns-facebook",googlePlusElement:"wc-sns-google-plus"}),"1"!==navigator.doNotTrack&&("complete"===document.webL10n.getReadyState()&&this.loadButtons(),window.addEventListener("localized",this))};SNSPushView.prototype=new View,SNSPushView.prototype.FACEBOOK_BUTTON_URL="https://www.facebook.com/plugins/like.php?href=%url&layout=box_count&show_faces=false&width=55&action=like&font=trebuchet+ms&colorscheme=light&height=65&locale=%lang",SNSPushView.prototype.GOOGLEPLUS_BUTTON_URL="https://plusone.google.com/u/0/_/+1/fastbutton?url=%url&size=tall&count=true&annotation=bubble&lang=%lang",SNSPushView.prototype.beforeShow=function(){return"1"!==navigator.doNotTrack},SNSPushView.prototype.loadButtons=function(){var a=window.location.href;-1!==a.indexOf("#")&&(a=a.replace(/#.*$/,"").replace(/\?.*$/,""));var b=document.documentElement.lang;this.updateFrame(this.facebookElement,this.FACEBOOK_BUTTON_URL.replace(/%url/,encodeURIComponent(a)).replace(/%lang/,b.replace(/-/,"_"))),this.updateFrame(this.googlePlusElement,this.GOOGLEPLUS_BUTTON_URL.replace(/%url/,encodeURIComponent(a)).replace(/%lang/,b))},SNSPushView.prototype.updateFrame=function(a,b){for(;a.firstElementChild;)a.removeChild(a.firstElementChild);var c=document.createElement("iframe");c.src=b,c.setAttribute("scrolling","no"),c.setAttribute("frameborder","0"),c.setAttribute("allowTransparency","true"),a.appendChild(c)},SNSPushView.prototype.handleEvent=function(a){switch(a.type){case"localized":this.loadButtons()}};var PSMView=function(a){this.load(a,{name:"psm",element:"wc-psm"}),"complete"===document.webL10n.getReadyState()&&this.loadFrame(),window.addEventListener("localized",this)};PSMView.prototype=new View,PSMView.prototype.URL="//timdream.org/psm/#locale=%lang",PSMView.prototype.loadFrame=function(){for(var a=document.documentElement.lang,b=this.element;b.firstElementChild;)b.removeChild(b.firstElementChild);var c=document.createElement("iframe");c.src=this.URL.replace(/%lang/,a),c.setAttribute("scrolling","no"),c.setAttribute("frameborder","0"),c.setAttribute("allowTransparency","true"),b.appendChild(c)},PSMView.prototype.handleEvent=function(a){switch(a.type){case"localized":this.loadFrame()}};var CanvasView=function(a){this.load(a,{name:"canvas",element:"wc-canvas",canvasElement:"wc-canvas-canvas",hoverElement:"wc-canvas-hover",hoverLabelElement:"wc-canvas-hover-label"}),window.addEventListener("resize",this),this.canvasElement.addEventListener("wordcloudstop",this),this.documentWidth=window.innerWidth,this.documentHeight=window.innerHeight;var b=this.canvasElement.style;["transform","webkitTransform","msTransform","oTransform"].some(function(a){return a in b&&(this.cssTransformProperty=a,!0)}.bind(this)),this.idleOption={fontFamily:"Times, serif",color:"rgba(255, 255, 255, 0.8)",rotateRatio:.5,backgroundColor:"transparent",wait:75,list:function(){var a=[],b=[5,4,3,2,2],c="Arai,Awan,Bodjal,Boira,Bulud,Bulut,Caad,Chmura,Clood,Cloud,Cwmwl,Dampog,Debesis,Ewr,Felhő,Hodei,Hûn,Koumoul,Leru,Lipata,Mixtli,Moln,Mây,Méga,Mākoņi,Neul,Niula,Nivulu,Nor,Nouage,Nuage,Nube,Nubes,Nubia,Nubo,Nuvem,Nuvi,Nuvia,Nuvola,Nwaj,Nívol,Nóvvla,Nùvoła,Nùvula,Núvol,Nûl,Nûlêye,Oblaci,Oblak,Phuyu,Pil'v,Pilv,Pilvi,Qinaya,Rahona,Rakun,Retë,Scamall,Sky,Ský,Swarken,Ulap,Vo'e,Wingu,Wolcen,Wolk,Wolke,Wollek,Wulke,dilnu,Νέφος,Абр,Болот,Болытлар,Булут,Бұлттар,Воблакі,Облак,Облака,Хмара,Үүл,Ամպ,וואלקן,ענן,ابر,بادل,بدل,سحاب,ورېځ,ھەور,ܥܢܢܐ,ढग,बादल,सुपाँय्,মেঘ,ਬੱਦਲ,વાદળ,முகில்,మేఘం,മേഘം,เมฆ,སྤྲིན།,ღრუბელი,ᎤᎶᎩᎸ,ᓄᕗᔭᖅ,云,雲,구름".split(",");return b.forEach(function(b){c.forEach(function(c){a.push([c,b])})}),a}()}};CanvasView.prototype=new View,CanvasView.prototype.TILT_DEPTH=10,CanvasView.prototype.beforeShow=CanvasView.prototype.beforeHide=function(a,b){switch(b){case this.app.UI_STATE_SOURCE_DIALOG:if(a==this.app.UI_STATE_ABOUT_DIALOG)break;this.drawIdleCloud();break;case this.app.UI_STATE_LOADING:case this.app.UI_STATE_WORKING:this.empty()}},CanvasView.prototype.handleEvent=function(a){switch(a.type){case"resize":this.documentWidth=window.innerWidth,this.documentHeight=window.innerHeight;break;case"wordclouddrawn":if(a.detail.drawn)break;a.preventDefault();break;case"wordcloudstop":this.canvasElement.removeEventListener("wordclouddrawn",this);break;case"mousemove":var b=this.documentWidth/2,c=this.documentHeight/2,d=-(b-a.pageX)/b*this.TILT_DEPTH,e=(c-a.pageY)/c*this.TILT_DEPTH;this.canvasElement.style[this.cssTransformProperty]="scale(1.2) translateZ(0) rotateX("+e+"deg) rotateY("+d+"deg)"}},CanvasView.prototype.setDimension=function(a,b){var c=this.canvasElement;a=a||this.documentWidth,b=b||this.documentHeight,c.setAttribute("width",a),c.setAttribute("height",b),this.element.style.marginLeft=-a/2+"px",this.element.style.marginTop=-b/2+"px"},CanvasView.prototype.draw=function(a){this.canvasElement.lang="",this.hoverElement.setAttribute("hidden",!0),a.hover=this.handleHover.bind(this),WordCloud(this.canvasElement,a)},CanvasView.prototype.handleHover=function(a,b,c){var d=this.hoverElement;if(!a)return void d.setAttribute("hidden",!0);d.removeAttribute("hidden"),d.style.left=b.x+"px",d.style.top=b.y+"px",d.style.width=b.w+"px",d.style.height=b.h+"px",this.hoverDimension=b,this.hoverLabelElement.setAttribute("data-l10n-args",JSON.stringify({word:a[0],count:a[1]})),__(this.hoverLabelElement)},CanvasView.prototype.drawIdleCloud=function(){var a=this.canvasElement,b=this.documentWidth,c=this.documentHeight;"ontouchstart"in window||document.addEventListener("mousemove",this),this.canvasElement.style[this.cssTransformProperty]="scale(1.2)",this.setDimension(b,c),this.idleOption.gridSize=Math.round(16*b/1024),this.idleOption.weightFactor=function(a){return Math.pow(a,2.3)*b/1024},a.lang="en",a.addEventListener("wordclouddrawn",this),WordCloud(a,this.idleOption),this.hoverElement.setAttribute("hidden",!0)},CanvasView.prototype.empty=function(){document.removeEventListener("mousemove",this),this.canvasElement.style[this.cssTransformProperty]="",WordCloud(this.canvasElement,{backgroundColor:"transparent"})};var SourceDialogView=function(a){this.load(a,{name:"source-dialog",element:"wc-source-dialog",menuElement:"wc-source-menu",selectionElement:"wc-source-selection",startBtnElement:"wc-source-start-btn",panelContainerElement:"wc-source-panels",aboutBtnElement:"wc-source-about-btn"}),this.currentPanel=null,this.panels={};var b=this.selectionElement,c=this.menuElement.getElementsByTagName("a");Array.prototype.forEach.call(c,function(a){var c=document.createElement("option");c.value=a.getAttribute("data-panel"),c.setAttribute("data-l10n-id",a.getAttribute("data-l10n-id")),c.appendChild(document.createTextNode(a.textContent)),b.appendChild(c)}),this.menuElement.addEventListener("click",this),this.selectionElement.addEventListener("change",this),this.startBtnElement.addEventListener("click",this),this.panelContainerElement.addEventListener("submit",this),this.aboutBtnElement.addEventListener("click",this)};SourceDialogView.prototype=new View,SourceDialogView.prototype.afterShow=function(){this.currentPanel&&this.currentPanel.show()},SourceDialogView.prototype.handleEvent=function(a){var b;if(a.preventDefault(),"submit"==a.type)return void this.currentPanel.submit();switch(a.currentTarget){case this.menuElement:if(!(b=a.target.getAttribute("data-panel"))||!this.panels[b])return;this.showPanel(this.panels[b]);break;case this.selectionElement:if(!(b=a.target.value)||!this.panels[b])return;this.showPanel(this.panels[b]);break;case this.aboutBtnElement:this.app.switchUIState(this.app.UI_STATE_ABOUT_DIALOG);break;case this.startBtnElement:this.currentPanel.submit()}},SourceDialogView.prototype.submit=function(a){return this.app.pushUrlHash(a)},SourceDialogView.prototype.showPanel=function(a){this.currentPanel&&this.currentPanel.hide(),a.show(),this.currentPanel=a,this.app&&this.app.logAction("SourceDialogView::showPanel",a.name)},SourceDialogView.prototype.addPanel=function(a){if(this.panels[a.name]=a,a.menuItemElement=this.menuElement.querySelector('[data-panel="'+a.name+'"]'),a.selectionIndex=Array.prototype.indexOf.call(this.menuElement.children,a.menuItemElement.parentNode),!a.menuItemElement)throw"menuItemElement not found.";if(a.menuItemElement.parentNode.removeAttribute("hidden"),a.dialog=this,"isSupported"in a&&!a.isSupported)return a.menuItemElement.parentNode.className+=" disabled",void a.menuItemElement.removeAttribute("data-panel");this.currentPanel||this.showPanel(a)};var DashboardView=function(a){this.load(a,{name:"dashboard",element:"wc-dashboard"});for(var b=this.element.querySelectorAll("[data-action]"),c=b.length;c--;)b[c].addEventListener("click",this)};DashboardView.prototype=new View,DashboardView.prototype.beforeShow=DashboardView.prototype.beforeHide=function(a,b){var c,d=this.element.querySelectorAll("[data-canvas-ctl]"),e=d.length;if(b===this.app.UI_STATE_DASHBOARD)for(;e--;)c=d[e],c.className=c.className.replace(/ disabled/g,"");else for(;e--;)c=d[e],c.className+=" disabled"},DashboardView.prototype.handleEvent=function(a){var b=a.currentTarget;if(-1===b.className.indexOf("disabled")){var c=this.app,d=b.getAttribute("data-action");switch(this.app.logAction("DashboardView::action",d),d){case"back":c.reset();break;case"refresh":c.draw();break;case"theme":c.data.theme++,c.data.theme>=c.themes.length&&(c.data.theme=0),c.draw();break;case"shape":c.data.shape++,c.data.shape>=c.shapes.length&&(c.data.shape=0),c.draw();break;case"edit":c.switchUIState(c.UI_STATE_LIST_DIALOG);break;case"size+":c.data.weightFactor+=.1,c.draw();break;case"size-":if(c.data.weightFactor<=.1)break;c.data.weightFactor-=.1,c.draw();break;case"gap+":c.data.gridSize++,c.draw();break;case"gap-":if(c.data.gridSize<=2)break;c.data.gridSize--,c.draw();break;case"save":var e=c.getCanvasElement().toDataURL();if("download"in document.createElement("a"))b.href=e,setTimeout(function(){b.href="#"},0);else{a.preventDefault();var f=window.open("blank.html","_blank","width=500,height=300,resizable=yes,menubar=yes"),g=function a(){f.removeEventListener("load",a),f.detachEvent&&f.detachEvent("onload",a);for(var b=f.document;b.body.firstElementChild;)b.body.removeChild(b.body.firstElementChild);var c=b.createElement("img");c.id="popup-image",c.src=e,b.getElementsByTagName("title")[0].textContent=_("image-popup-title"),b.body.appendChild(c)};f.attachEvent?"complete"===f.document.readyState?g():f.attachEvent("onload",g):f.addEventListener("load",g)}break;case"share":c.showSharer()}}};var SharerDialogView=function(a){if(this.load(a,{name:"sharer-dialog",element:"wc-sharer-dialog",titleElement:"wc-sharer-title",imgElement:"wc-sharer-img",imgLinkElement:"wc-sharer-img-link",progressElement:"wc-sharer-progress",titleInputElement:"wc-sharer-title-input",descInputElement:"wc-sharer-desc",termsElement:"wc-sharer-terms",hashTagElement:"wc-sharer-hashtag",imgurStatusElement:"wc-sharer-imgur-status",facebookStatusElement:"wc-sharer-facebook-status",tumblrStatusElement:"wc-sharer-tumblr-status",twitterStatusElement:"wc-sharer-twitter-status",plurkStatusElement:"wc-sharer-plurk-status",reUploadBtnElement:"wc-sharer-reupload-btn",doneBtnElement:"wc-sharer-done-btn"}),this.hashTagElement.textContent=this.HASHTAG,this.imgLinkElement.addEventListener("click",this),this.imgurStatusElement.addEventListener("click",this),this.facebookStatusElement.addEventListener("click",this),this.tumblrStatusElement.addEventListener("click",this),this.twitterStatusElement.addEventListener("click",this),this.plurkStatusElement.addEventListener("click",this),this.doneBtnElement.addEventListener("click",this),this.reUploadBtnElement.addEventListener("click",this),window.URL&&this.imgElement.addEventListener("load",function(a){window.URL.revokeObjectURL(this.src)}),!window.HTMLCanvasElement.prototype.toBlob){var b=document.createElement("script");b.src="./assets/canvas-to-blob/canvas-to-blob.min.js?_=jatqawb2",document.documentElement.firstElementChild.appendChild(b)}this.stringIds=["image-upload-not-supported","share-text-only","image-uploading","waiting","image-uploaded","click-to-share","image-upload-failed","facebook-loading","load-facebook-sdk","facebook-sdk-loading"]};SharerDialogView.prototype=new View,SharerDialogView.prototype.HASHTAG="#HTML5WordCloud",SharerDialogView.prototype.TWITTER_SHARE_URL="https://twitter.com/home/?status=",SharerDialogView.prototype.PLURK_SHARE_URL="https://plurk.com/?status=",SharerDialogView.prototype.FACEBOOK_PHOTO_URL="https://www.facebook.com/photo.php?fbid=",SharerDialogView.prototype.FACEBOOK_POST_URL="https://www.facebook.com/permalink.php?id=%uid&v=wall&story_fbid=%fbid",SharerDialogView.prototype.IMGUR_URL="https://imgur.com/",SharerDialogView.prototype.IMGUR_API_URL="https://api.imgur.com/3/upload.json",SharerDialogView.prototype.SHARED_ITEM_LIMIT=10,SharerDialogView.prototype.LABEL_IMAGE_UPLOAD_NOT_SUPPORTED=0,SharerDialogView.prototype.LABEL_SHARE_TEXT_ONLY=1,SharerDialogView.prototype.LABEL_IMAGE_UPLOADING=2,SharerDialogView.prototype.LABEL_WAITING=3,SharerDialogView.prototype.LABEL_IMAGE_UPLOADED=4,SharerDialogView.prototype.LABEL_CLICK_TO_SHARE=5,SharerDialogView.prototype.LABEL_IMAGE_UPLOAD_FAILED=6,SharerDialogView.prototype.LABEL_FACEBOOK_LOADING=7,SharerDialogView.prototype.LABEL_LOAD_FBSDK=8,SharerDialogView.prototype.LABEL_FBSDK_LOADING=9,SharerDialogView.prototype.beforeShow=function(){window.FB&&!this.facebookSDKReadyState&&(this.facebookSDKReadyState="complete",FB.getLoginStatus(this.updateFacebookStatus.bind(this)),FB.Event.subscribe("auth.authResponseChange",this.updateFacebookStatus.bind(this))),this.uploadSupported=!!(window.HTMLCanvasElement.prototype.toBlob&&window.XMLHttpRequest&&window.FormData),this.uploadSupported&&!this.imgurData?this.uploadImage():this.updateUI()},SharerDialogView.prototype.updateTermsUI=function(){this.termsElement.textContent=this.getCloudList()},SharerDialogView.prototype.getCloudTitle=function(){return this.app.data.title||_("my-word-cloud")},SharerDialogView.prototype.getCloudList=function(){var a=this.app.data.list,b=0,c=[];do{c[b]=a[b][0]}while(++b<this.SHARED_ITEM_LIMIT);return c.join(_("sep").replace(/"/g,""))+(a.length>this.SHARED_ITEM_LIMIT?_("frequent-terms-more"):"")},SharerDialogView.prototype.updateFacebookStatusElement=function(a,b){var c=this.facebookStatusElement;switch(this.facebookSDKReadyState){case"complete":this.updateStatusElement(c,a,b);break;case"loading":this.updateStatusElement(c,this.LABEL_FBSDK_LOADING);break;default:this.updateStatusElement(c,this.LABEL_LOAD_FBSDK,"#")}},SharerDialogView.prototype.updateStatusElement=function(a,b,c){c?(a.className="",a.href=c):(a.className="disabled",a.href=""),a.setAttribute("data-l10n-id",this.stringIds[b]),__(a)},SharerDialogView.prototype.updateUI=function(){if(this.xhr)this.reUploadBtnElement.disabled=!0,this.updateStatusElement(this.imgurStatusElement,this.LABEL_IMAGE_UPLOADING),this.updateFacebookStatusElement(this.LABEL_WAITING),this.updateStatusElement(this.tumblrStatusElement,this.LABEL_WAITING),this.updateStatusElement(this.twitterStatusElement,this.LABEL_WAITING),this.updateStatusElement(this.plurkStatusElement,this.LABEL_WAITING);else if(this.imgurData){var a=this.IMGUR_URL+this.imgurData.id;this.reUploadBtnElement.disabled=!1,this.updateStatusElement(this.imgurStatusElement,this.LABEL_IMAGE_UPLOADED,a),this.facebookPostedUrl?this.updateStatusElement(this.facebookStatusElement,this.LABEL_IMAGE_UPLOADED,this.facebookPostedUrl):this.facebookLoading?this.updateStatusElement(this.facebookStatusElement,this.LABEL_FACEBOOK_LOADING):this.updateFacebookStatusElement(this.LABEL_CLICK_TO_SHARE,"#"),this.updateStatusElement(this.tumblrStatusElement,this.LABEL_CLICK_TO_SHARE,"#"),this.updateStatusElement(this.twitterStatusElement,this.LABEL_CLICK_TO_SHARE,"#"),this.updateStatusElement(this.plurkStatusElement,this.LABEL_CLICK_TO_SHARE,"#")}else this.uploadSupported||this.updateTermsUI(),this.reUploadBtnElement.disabled=!0,this.uploadSupported?this.updateStatusElement(this.imgurStatusElement,this.LABEL_IMAGE_UPLOAD_FAILED):this.updateStatusElement(this.imgurStatusElement,this.LABEL_IMAGE_UPLOAD_NOT_SUPPORTED),this.updateFacebookStatusElement(this.LABEL_SHARE_TEXT_ONLY,"#"),this.updateStatusElement(this.tumblrStatusElement,this.LABEL_SHARE_TEXT_ONLY,"#"),this.updateStatusElement(this.twitterStatusElement,this.LABEL_SHARE_TEXT_ONLY,"#"),this.updateStatusElement(this.plurkStatusElement,this.LABEL_SHARE_TEXT_ONLY,"#")},SharerDialogView.prototype.afterHide=function(){this.xhr&&(this.xhr.abort(),this.xhr=null)},SharerDialogView.prototype.handleEvent=function(a){if(a.target.disabled||"disabled"===a.target.className)return void a.preventDefault();switch(a.currentTarget){case this.imgLinkElement:if(this.imgurData)break;a.preventDefault();break;case this.facebookStatusElement:if(this.facebookPostedUrl)break;if(!this.facebookSDKReadyState)return this.facebookSDKReadyState="loading",this.updateUI(),(new FacebookSDKLoader).load(function(){"complete"!==this.facebookSDKReadyState&&(this.facebookSDKReadyState="complete",FB.getLoginStatus(this.updateFacebookStatus.bind(this)),FB.Event.subscribe("auth.authResponseChange",this.updateFacebookStatus.bind(this)))}.bind(this)),void a.preventDefault();this.share("facebook"),a.preventDefault();break;case this.tumblrStatusElement:this.share("tumblr"),a.preventDefault();break;case this.twitterStatusElement:this.share("twitter"),a.preventDefault();break
;case this.plurkStatusElement:this.share("plurk"),a.preventDefault();break;case this.reUploadBtnElement:this.uploadImage();break;case this.doneBtnElement:this.close()}},SharerDialogView.prototype.close=function(){this.app.switchUIState(this.app.UI_STATE_DASHBOARD)},SharerDialogView.prototype.getCanvasBlob=function(a){this.app.getCanvasElement().toBlob(a.bind(this))},SharerDialogView.prototype.updateProgress=function(a,b){this.progressElement.style.width=Math.floor(100*a)+"%",this.progressElement.parentNode.className="progress progress-striped"+(b?" active":"")},SharerDialogView.prototype.share=function(a){if("facebook"===a&&!window.UPLOAD_PHOTO_TO_FACEBOOK)return void this.shareText(a);this.imgurData?this.shareImage(a):this.shareText(a)},SharerDialogView.prototype.shareText=function(a){this.app.logAction("SharerDialogView::shareText",a);var b=this.titleInputElement.value||this.getCloudTitle(),c=this.descInputElement.value||this.getCloudList()+"\n\n"+this.HASHTAG,d=window.location.href,e=d.length>128?d.replace(/#.*$/,""):d;switch(a){case"facebook":var f=document.querySelector('meta[property="og:image"]').content;this.facebookLoading=!0,this.updateUI();var g;g=this.imgurData?{method:"feed",link:this.IMGUR_URL+this.imgurData.id,display:"popup"}:{method:"feed",picture:f,link:d,name:this.getCloudTitle(),description:this.getCloudList()+" -- "+this.HASHTAG,display:"popup"},FB.ui(g,function(a){if(this.facebookLoading=!1,!a||!a.post_id)return void this.updateUI();var b=a.post_id.split("_");this.facebookPostedUrl=this.FACEBOOK_POST_URL.replace(/%uid/,b[0]).replace(/%fbid/,b[1]),this.updateUI()}.bind(this));break;case"plurk":window.open(this.PLURK_SHARE_URL+encodeURIComponent(e+" ("+b+") "+c));break;case"twitter":window.open(this.TWITTER_SHARE_URL+encodeURIComponent(e+" "+b+" "+c),null,"width=575,height=216");break;case"tumblr":window.open("https://www.tumblr.com/share/link?description="+encodeURIComponent(c)+"&name="+encodeURIComponent(b)+"&url="+encodeURIComponent(d)),this.close();break;default:throw"Unknown shareDialogView type "+a}},SharerDialogView.prototype.updateFacebookStatus=function(a){"connected"===a.status?FB.api("/me/permissions",function(a){this.hasFacebookPermission=a&&a.data&&a.data[0]&&1==a.data[0].publish_stream,this.updateUI()}.bind(this)):this.hasFacebookPermission=!1,this.updateUI()},SharerDialogView.prototype.uploadImage=function(){if(!window.IMGUR_CLIENT_ID)throw"IMGUR_CLIENT_ID is not set.";this.app.logAction("SharerDialogView::uploadImage"),this.imgurData=void 0,this.facebookPostedUrl=void 0,this.imgLinkElement.href="#",this.updateProgress(.05,!0);var a=this.titleInputElement.value||this.getCloudTitle(),b=this.descInputElement.value||this.getCloudList()+"\n\n"+this.HASHTAG,c=window.location.href;c.length>128&&(c=c.replace(/#.*$/,"")),this.cloudUrl=c;var d=new FormData;d.append("title",a),d.append("name","wordcloud.png"),d.append("description",b+"\n\n"+c);var e=this.xhr=new XMLHttpRequest;e.open("POST",this.IMGUR_API_URL),e.setRequestHeader("Authorization","Client-ID "+IMGUR_CLIENT_ID),e.upload?e.upload.onprogress=function(a){this.updateProgress(a.loaded/a.total,!0)}.bind(this):this.updateProgress(1,!0),e.onreadystatechange=function(a){if(e.readyState===XMLHttpRequest.DONE&&this.xhr===e){this.checkImgurCredits(),this.xhr=null;var b;try{b=JSON.parse(e.responseText)}catch(a){}if(!(!!b&&b.success))return b&&429===b.status&&alert(_("imgur-limit-msg")),this.app.logAction("SharerDialogView::uploadImage::failed",b?b.status:"N/A"),this.updateProgress(.05,!1),void this.updateUI();this.imgurData=b.data,this.imgLinkElement.href=this.IMGUR_URL+this.imgurData.id,this.app.logAction("SharerDialogView::uploadImage::success"),this.updateProgress(1,!1),this.updateUI()}}.bind(this),this.updateUI(),this.updateTermsUI(),this.getCanvasBlob(function(a){this.xhr===e&&(window.URL?this.imgElement.src=window.URL.createObjectURL(a):this.imgElement.src=this.app.getCanvasElement().toDataURL(),this.imgLinkElement.removeAttribute("hidden"),d.append("image",a),e.send(d))})},SharerDialogView.prototype.shareImage=function(a){this.app.logAction("SharerDialogView::shareImage2",a);var b=this.titleInputElement.value||this.getCloudTitle(),c=this.descInputElement.value||this.getCloudList()+"\n\n"+this.HASHTAG,d=this.cloudUrl;switch(a){case"facebook":if(!this.hasFacebookPermission)return void FB.login(function(b){if(this.element.hasAttribute("hidden"))return void this.app.logAction("SharerDialogView::facebook-login::cancelled");this.app.logAction("SharerDialogView::facebook-login::success"),"connected"===b.status&&(this.hasFacebookPermission=!0,this.shareImage(a))}.bind(this),{scope:"publish_stream"});this.facebookLoading=!0,this.updateUI(),FB.api("/me/photos","post",{url:this.imgurData.link,message:this.titleInputElement.value+"\n\n"+this.descInputElement.value+"\n\n"+d},function(b){if(this.facebookLoading=!1,!b||!b.id)return this.shareText(a),void this.updateUI();this.facebookPostedUrl=this.FACEBOOK_PHOTO_URL+b.id,this.updateUI()}.bind(this));break;case"plurk":window.open(this.PLURK_SHARE_URL+encodeURIComponent(this.imgurData.link+" "+d+" ("+b+") "+c));break;case"twitter":window.open(this.TWITTER_SHARE_URL+encodeURIComponent(d+" "+b+" "+c+" "+this.imgurData.link));break;case"tumblr":window.open("https://www.tumblr.com/share/photo?source="+encodeURIComponent(this.imgurData.link)+"&desc="+encodeURIComponent(b+"\n"+c+"\n\n"+d)+"&clickthru="+encodeURIComponent(d));break;default:throw"Unknown shareDialogView type "+a}},SharerDialogView.prototype.checkImgurCredits=function(){var a=new XMLHttpRequest;a.open("GET","https://api.imgur.com/3/credits"),a.setRequestHeader("Authorization","Client-ID "+IMGUR_CLIENT_ID),a.onreadystatechange=function(b){if(a.readyState===XMLHttpRequest.DONE){var c;try{c=JSON.parse(a.responseText)}catch(a){}c&&c.success&&(this.imgurCreditsData=c.data,this.app.logAction("SharerDialogView::checkImgurCredits::ClientRemaining",c.data.ClientRemaining))}}.bind(this),a.send()};var PanelView=function(){};PanelView.prototype=new View,PanelView.prototype.beforeShow=function(){this.menuItemElement.parentNode.className+=" active",this.dialog.selectionElement.selectedIndex=this.selectionIndex},PanelView.prototype.afterShow=function(){var a=this.element.querySelector("input, button, select, textarea");a&&a.focus()},PanelView.prototype.beforeHide=function(){this.menuItemElement.parentNode.className=this.menuItemElement.parentNode.className.replace(/ active/g,"")};var ExamplePanelView=function(a){this.load(a,{name:"example",element:"wc-panel-example",supportMsgElement:"wc-panel-example-support-msg"}),this.checked=!1};ExamplePanelView.prototype=new PanelView,ExamplePanelView.prototype.beforeShow=function(){PanelView.prototype.beforeShow.apply(this,arguments),this.checked||(this.dialog.app.isFullySupported||this.supportMsgElement.removeAttribute("hidden"),this.checked=!0)},ExamplePanelView.prototype.submit=function(){var a=this.element.querySelectorAll('[name="example"]');for(var b in a)if(a[b].checked){this.dialog.submit("#"+a[b].value);break}};var CPPanelView=function(a){this.load(a,{name:"cp",element:"wc-panel-cp",textareaElement:"wc-panel-cp-textarea"})};CPPanelView.prototype=new PanelView,CPPanelView.prototype.submit=function(){var a=this.textareaElement;if(a.value.length){var b;b=window.btoa?this.dialog.submit("#base64:"+window.btoa(unescape(encodeURIComponent(a.value)))):this.dialog.submit("#text:"+encodeURIComponent(a.value)),b||this.dialog.submit("#text")}};var FilePanelView=function(a){if(this.load(a,{name:"file",element:"wc-panel-file",fileElement:"wc-panel-file-file",fileLabelElement:"wc-panel-file-file-label",encodingElement:"wc-panel-file-encoding"}),this.isSupported){var b=this.fileElement.files.length;this.updateLabel(b),this.fileElement.addEventListener("change",this)}};FilePanelView.prototype=new PanelView,FilePanelView.prototype.handleEvent=function(a){var b=this.fileElement.files.length;this.updateLabel(b)},FilePanelView.prototype.updateLabel=function(a){this.fileLabelElement.setAttribute("data-l10n-args",'{ "n": '+a+"}"),__(this.fileLabelElement)},FilePanelView.prototype.isSupported=!!window.FileReader,FilePanelView.prototype.submit=function(){var a=this.fileElement;if(a.files.length){if("text/plain"!==a.files[0].type)return void alert(_("plain-text-file-please"));this.dialog.submit("#file")}};var WikipediaPanelView=function(a){this.load(a,{name:"wikipedia",element:"wc-panel-wikipedia",inputElement:"wc-panel-wikipedia-title"})};WikipediaPanelView.prototype=new PanelView,WikipediaPanelView.prototype.submit=function(){var a=this.inputElement;if(a.value){var b=document.webL10n.getLanguage().substr(0,2);this.dialog.submit("#wikipedia."+b+":"+a.value)}};var GooglePlusPanelView=function(a){this.load(a,{name:"googleplus",element:"wc-panel-googleplus",statusElement:"wc-panel-googleplus-status",idElement:"wc-panel-googleplus-id"}),this.stringIds=["google-ready","google-start-to-login"],this.loaded=!1};GooglePlusPanelView.prototype=new PanelView,GooglePlusPanelView.prototype.LABEL_LOGGED_IN=0,GooglePlusPanelView.prototype.LABEL_NOT_LOGGED_IN=1,GooglePlusPanelView.prototype.beforeShow=function(){if(PanelView.prototype.beforeShow.apply(this,arguments),!GOOGLE_CLIENT_ID)throw"No GOOGLE_CLIENT_ID defined.";if(!this.loaded){this.loaded=!0;var a=document.createElement("script");a.src="./assets/go2/src/google-oauth2.js?_=jatqawb2",a.onload=a.onerror=function(){if(a.onload=a.onerror=null,!window.GO2)return void(this.loaded=!1);var b=window.GO2_REDIRECT_URI||document.location.href.replace(/\/(index.html)?(#.*)?$/i,"/go2-redirect.html"),c=this.go2=new GO2({clientId:GOOGLE_CLIENT_ID,scope:this.GOOGLE_API_SCOPE||"",redirectUri:b});c.login(!1,!0),this.updateUI(),c.onlogin=function(a){if(this.accessToken=a,this.updateUI(),this.submitted){if(this.submitted=!1,this.element.hasAttribute("hidden")||this.dialog.element.hasAttribute("hidden"))return;this.realSubmit()}}.bind(this),c.onlogout=function(){this.accessToken="",this.updateUI()}.bind(this)}.bind(this),document.documentElement.firstElementChild.appendChild(a)}},GooglePlusPanelView.prototype.isReadyForFetch=function(){return!!this.accessToken},GooglePlusPanelView.prototype.updateUI=function(){this.isReadyForFetch()?this.statusElement.setAttribute("data-l10n-id",this.stringIds[this.LABEL_LOGGED_IN]):this.statusElement.setAttribute("data-l10n-id",this.stringIds[this.LABEL_NOT_LOGGED_IN]),__(this.statusElement)},GooglePlusPanelView.prototype.submit=function(){if(window.GO2&&this.loaded)return this.isReadyForFetch()?void this.realSubmit():(this.submitted=!0,void this.go2.login(!0,!1))},GooglePlusPanelView.prototype.realSubmit=function(){var a=this.idElement.value;a||(a="me"),a=a.replace(/\/.*$/,""),this.dialog.submit("#googleplus:"+a)};var Fetcher=function(){};Fetcher.prototype.LABEL_VERB=LoadingView.prototype.LABEL_LOADING;var TextFetcher=function(){this.types=["text","base64"]};TextFetcher.prototype=new Fetcher,TextFetcher.prototype.stop=function(){clearTimeout(this.timer)},TextFetcher.prototype.getData=function(a,b){b="text"!==a||b?"base64"===a?decodeURIComponent(escape(window.atob(b))):decodeURIComponent(b):this.app.views["source-dialog"].panels.cp.textareaElement.value,this.timer=setTimeout(function(){this.app.handleData(b)}.bind(this),0)};var FileFetcher=function(){this.types=["file"]};FileFetcher.prototype=new Fetcher,FileFetcher.prototype.stop=function(){this.reader&&(this.reader.abort(),this.reader=null)},FileFetcher.prototype.getData=function(a,b){var c=this.app.views["source-dialog"].panels.file,d=c.fileElement;if(!d.files.length)return this.app.reset(),void this.app.views["source-dialog"].showPanel(c);var e=d.files[0],f=this.reader=new FileReader;f.onloadend=function(a){if(f===this.reader&&null!==f.result){var b=f.result;this.app.handleData(b)}}.bind(this),f.readAsText(e,c.encodingElement.value||"UTF-8")};var ListFetcher=function(){this.types=["list","base64-list"]};ListFetcher.prototype=new Fetcher,ListFetcher.prototype.stop=function(){clearTimeout(this.timer)},ListFetcher.prototype.getData=function(a,b){var c;c="list"!==a||b?"base64-list"===a?decodeURIComponent(escape(window.atob(b))):decodeURIComponent(b):this.app.views["list-dialog"].textElement.value;var d=0,e=[];c.split("\n").forEach(function(a){var b=a.split("\t").reverse();a&&b[0]&&b[1]&&(b[1]=parseInt(b[1],10),isNaN(b[1])||(d+=b[0].length*b[1]*b[1],e.push(b)))}),this.timer=setTimeout(function(){this.app.handleList(e,d)}.bind(this),0)};var JSONPScriptDownloader=function(){};JSONPScriptDownloader.prototype.CALLBACK_PREFIX="JSONPCallbackX",JSONPScriptDownloader.prototype.reset=JSONPScriptDownloader.prototype.stop=function(){this.currentRequest=void 0,clearTimeout(this.timer)},JSONPScriptDownloader.prototype.handleEvent=function(a){var b=a.target;window[b.getAttribute("data-callback-name")]=void 0,this.currentRequest=void 0,clearTimeout(this.timer),b.parentNode.removeChild(b),"error"===a.type&&this.fetcher.handleResponse()},JSONPScriptDownloader.prototype.getNewCallbackName=function(){var a=this.CALLBACK_PREFIX+Math.random().toString(36).substr(2,8).toUpperCase();return window[a]=function(){this.currentRequest===a&&(this.currentRequest=void 0,clearTimeout(this.timer),this.fetcher.handleResponse.apply(this.fetcher,arguments))}.bind(this),a},JSONPScriptDownloader.prototype.requestData=function(a){var b=this.currentRequest=this.getNewCallbackName();a+=-1===a.indexOf("?")?"?":"&",a+="callback="+b;var c=this.scriptElement=document.createElement("script");c.src=a,c.setAttribute("data-callback-name",b),c.addEventListener("load",this),c.addEventListener("error",this),document.documentElement.firstElementChild.appendChild(c),clearTimeout(this.timer),this.timer=setTimeout(function(){window[b]()},this.fetcher.TIMEOUT)};var JSONPWorkerDownloader=function(){};JSONPWorkerDownloader.prototype.PATH="./assets/",JSONPWorkerDownloader.prototype.reset=JSONPWorkerDownloader.prototype.stop=function(){this.worker&&(clearTimeout(this.timer),this.worker.terminate(),this.worker=null)},JSONPWorkerDownloader.prototype.requestData=function(a){this.worker&&this.stop(),this.worker=new Worker(this.PATH+"downloader-worker.js"),this.worker.addEventListener("message",this),this.worker.addEventListener("error",this),this.worker.postMessage(a),clearTimeout(this.timer),this.timer=setTimeout(function(){this.stop(),this.fetcher.handleResponse()}.bind(this),this.fetcher.TIMEOUT)},JSONPWorkerDownloader.prototype.handleEvent=function(a){var b;switch(a.type){case"message":b=a.data;break;case"error":b=[],a.preventDefault()}this.stop(),this.fetcher.handleResponse.apply(this.fetcher,b)};var JSONPFetcher=function(){};JSONPFetcher.prototype=new Fetcher,JSONPFetcher.prototype.LABEL_VERB=LoadingView.prototype.LABEL_DOWNLOADING,JSONPFetcher.prototype.USE_WORKER_WHEN_AVAILABLE=!0,JSONPFetcher.prototype.TIMEOUT=3e4,JSONPFetcher.prototype.reset=function(){this.downloader&&this.downloader.reset()},JSONPFetcher.prototype.stop=function(){this.downloader&&this.downloader.stop(),this.downloader=null},JSONPFetcher.prototype.requestData=function(a){this.USE_WORKER_WHEN_AVAILABLE&&window.Worker?this.downloader=new JSONPWorkerDownloader:this.downloader=new JSONPScriptDownloader,this.downloader.fetcher=this,this.downloader.requestData(a)};var WikipediaFetcher=function(a){this.types=["wiki","wikipedia"],this.params=[["action","query"],["prop","revisions"],["rvprop","content"],["redirects","1"],["format","json"],["rvparse","1"]]};WikipediaFetcher.prototype=new JSONPFetcher,WikipediaFetcher.prototype.WIKIPEDIA_API_URL="https://%lang.wikipedia.org/w/api.php",WikipediaFetcher.prototype.DEFAULT_LANG="en",WikipediaFetcher.prototype.PARSED_WIKITEXT_REGEXP=/<[^>]+?>|\(.+?\.\.\.\)|\&\w+\;|<script.+?\/script\>/gi,WikipediaFetcher.prototype.getData=function(a,b){var c=[].concat(this.params),d=a.split("."),e=d[1]?d[1]:this.DEFAULT_LANG;d[2]&&c.push(["converttitles",d[2]]),c.push(["titles",b]);var f=this.WIKIPEDIA_API_URL.replace(/%lang/,e)+"?"+c.map(function(a){return a[0]+"="+encodeURIComponent(a[1])}).join("&");this.requestData(f)},WikipediaFetcher.prototype.handleResponse=function(a){if(!a)return void this.app.handleData("");var b=Object.keys(a.query.pages)[0],c=a.query.pages[b];if(!("revisions"in c))return void this.app.handleData("");var d=c.revisions[0]["*"].replace(this.PARSED_WIKITEXT_REGEXP,"");this.app.handleData(d,_("wikipedia-title",{title:c.title}))};var GooglePlusFetcher=function(a){this.types=["googleplus"],this.params=[["maxResults","100"],["alt","json"],["pp","1"]]};GooglePlusFetcher.prototype=new JSONPFetcher,GooglePlusFetcher.prototype.GOOGLE_PLUS_API_URL="https://www.googleapis.com/plus/v1/people/%source/activities/public",GooglePlusFetcher.prototype.POST_REGEXP=/<[^>]+?>|\(.+?\.\.\.\)|\&\w+\;|<script.+?\/script\>/gi,GooglePlusFetcher.prototype.getData=function(a,b){var c=this.app.views["source-dialog"].panels.googleplus,d=c.accessToken;if(!d)return this.app.logAction("GooglePlusFetcher::getData::reset"),this.app.reset(),void this.app.views["source-dialog"].showPanel(c);var e=[].concat(this.params);e.push(["access_token",d]);var f=this.GOOGLE_PLUS_API_URL.replace(/%source/,b)+"?"+e.map(function(a){return a[0]+"="+encodeURIComponent(a[1])}).join("&");this.requestData(f)},GooglePlusFetcher.prototype.handleResponse=function(a){if(!a||a.error||!a.items)return void this.app.handleData("");var b=a.items.map(function(a){return a.object.content.replace(this.POST_REGEXP,"")}.bind(this)).join("");this.app.handleData(b,_("google-plus-title"))};var COSCUPFetcher=function(a){this.types=["coscup"],this.fields=["name","speaker","bio","abstract"]};COSCUPFetcher.prototype=new JSONPFetcher,COSCUPFetcher.prototype.API_URL="http://coscup.org/%year/api/program",COSCUPFetcher.prototype.HTML_REGEXP=/<[^>]+?>|\(.+?\.\.\.\)|\&\w+\;|<script.+?\/script\>/gi,COSCUPFetcher.prototype.getData=function(a,b){var c=this.year=b;this.requestData(this.API_URL.replace(/%year/,c))},COSCUPFetcher.prototype.handleResponse=function(a){if(!a)return void this.app.handleData("");var b=[],c=this.fields,d=this.HTML_REGEXP;(Array.isArray(a)?a:a.program).forEach(function(a){c.forEach(function(c){a[c]&&b.push(a[c].replace(d,""))})}),this.app.handleData(b.join("\n"),_("coscup-title",{year:this.year}))};var _gaq=_gaq||[];"1"===navigator.doNotTrack||"timc.idv.tw"!==window.location.hostname&&"timdream.org"!==window.location.hostname?window.console&&(_gaq.push=function(){Function.prototype.apply.call(console.log,console,arguments),Array.prototype.push.apply(this,arguments)}):("timc.idv.tw"===window.location.hostname?_gaq.push(["_setAccount","UA-401106-1"]):_gaq.push(["_setAccount","UA-4623408-2"]),_gaq.push(["_trackPageview"]),function(){var a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b)}()),window.onerror=function(a,b,c){_gaq.push(["_trackEvent","JavaScript Exceptions",a,b+" ("+c+")"])},function(){if(document.querySelectorAll&&window.console){var a=document.querySelector('meta[property="og:image"]').content,b=document.querySelector('meta[property="og:url"]').content,c=document.querySelector('meta[property="fb:app_id"]').content,d=window.location.href.replace(/#.*$/,"").replace(/\?.*$/,"");(a.substr(0,d.length)!==d||b.substr(0,d.length)!==d||window.FACEBOOK_APP_ID&&c!==window.FACEBOOK_APP_ID)&&console.warn("Remember to change the content of <meta> tags in HTML.")}}(),function(){void 0===window.__&&(window.__=document.webL10n.translate),WordFreq.isSupported?WordFreqSync=null:WordFreq=null;var a=new WordCloudApp;if(a.isSupported){(new LanguageSwitcherView).app=a;(new SNSPushView).show();(new PSMView).show(),a.addView(new CanvasView),a.addView(new LoadingView),a.addView(new DashboardView),a.addView(new ListDialogView),a.addView(new SharerDialogView),a.addView(new AboutDialogView);var b=new SourceDialogView;a.addView(b),b.addPanel(new ExamplePanelView),b.addPanel(new CPPanelView),b.addPanel(new FilePanelView),b.addPanel(new WikipediaPanelView),b.addPanel(new GooglePlusPanelView),a.addFetcher(new TextFetcher),a.addFetcher(new FileFetcher),a.addFetcher(new ListFetcher),a.addFetcher(new COSCUPFetcher),a.addFetcher(new WikipediaFetcher),a.addFetcher(new GooglePlusFetcher)}}();